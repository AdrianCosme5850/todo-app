{"ast":null,"code":"var _jsxFileName = \"/home/adrian/codefellows/401/todo-app/src/context/authContext.jsx\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\nimport { useState, createContext, useEffect } from 'react';\nimport axios from 'axios';\nimport base64 from 'base-64';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\n\n// const testUsers = {\n//     Administrator: {\n//       password: 'admin',\n//       name: 'Administrator',\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiQWRtaW5pc3RyYXRvciIsInJvbGUiOiJhZG1pbiIsImNhcGFiaWxpdGllcyI6IlsnY3JlYXRlJywncmVhZCcsJ3VwZGF0ZScsJ2RlbGV0ZSddIiwiaWF0IjoxNTE2MjM5MDIyfQ.pAZXAlTmC8fPELk2xHEaP1mUhR8egg9TH5rCyqZhZkQ'\n//     },\n//     Editor: {\n//       password: 'editor',\n//       name: 'Editor',\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiRWRpdG9yIiwicm9sZSI6ImVkaXRvciIsImNhcGFiaWxpdGllcyI6IlsncmVhZCcsJ3VwZGF0ZSddIiwiaWF0IjoxNTE2MjM5MDIyfQ.3aDn3e2pf_J_1rZig8wj9RiT47Ae2Lw-AM-Nw4Tmy_s'\n//     },\n//     Writer: {\n//       password: 'writer',\n//       name: 'Writer',\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiV3JpdGVyIiwicm9sZSI6IndyaXRlciIsImNhcGFiaWxpdGllcyI6IlsnY3JlYXRlJ10iLCJpYXQiOjE1MTYyMzkwMjJ9.dmKh8m18mgQCCJp2xoh73HSOWprdwID32hZsXogLZ68'\n//     },\n//     User: {\n//       password: 'user',\n//       name: 'User',\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiVXNlciIsInJvbGUiOiJ1c2VyIiwiY2FwYWJpbGl0aWVzIjoiWydyZWFkJ10iLCJpYXQiOjE1MTYyMzkwMjJ9.WXYvIKLdPz_Mm0XDYSOJo298ftuBqqjTzbRvCpxa9Go'\n//     },\n//   };\n\nconst AuthContextProvider = function (props) {\n  _s();\n  let [loggedIn, setLoggedIn] = useState(false);\n  let [capabilities, setCapabilities] = useState([]);\n  let [error, setError] = useState(null);\n  let [token, setToken] = useState();\n  let signUp = async (username, password) => {\n    try {\n      let object = JSON.stringify({\n        username: username,\n        password: password,\n        role: 'admin'\n      });\n      console.log(object);\n      let user = await fetch('http://localhost:3001/signup', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: object\n      });\n      let parsedUser = user.json();\n      console.log(parsedUser);\n      cookie.save('auth', parsedUser);\n      setLoggedIn(true);\n      setCapabilities(parsedUser.capabilities);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n  let login = async (username, password) => {\n    try {\n      let encodedCredentials = base64.encode(username + ':' + password);\n      console.log(encodedCredentials);\n      let config = {\n        headers: {\n          'Authorization': 'Basic ' + encodedCredentials\n        }\n      };\n      let user = await axios.post('http://localhost:3001/signin', {}, config);\n      // let parsedUser = user.json();\n      console.log(user.data);\n      cookie.save('auth', user.data.token);\n      setLoggedIn(true);\n      setCapabilities(user.data.user.capabilities);\n      setToken(user.data.token);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n  let validateToken = token => {\n    try {\n      let User = jwt_decode(token);\n      console.log(User);\n      setLoggedIn(true);\n      setCapabilities(User.capabilities);\n    } catch (e) {\n      setLoggedIn(false);\n      setCapabilities([]);\n      console.log('bad token');\n    }\n  };\n  let logout = () => {\n    setLoggedIn(false);\n    setCapabilities([]);\n  };\n  useEffect(() => {\n    // const cookieToken = cookie.load('auth');\n    // console.log(cookieToken)\n    // validateToken(cookieToken.token);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      loggedIn,\n      setLoggedIn,\n      capabilities,\n      setCapabilities,\n      error,\n      setError,\n      login,\n      logout,\n      signUp,\n      token\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthContextProvider, \"/GARj204bpA/OP9WQX0Y4ZQOj3k=\");\n_c = AuthContextProvider;\nexport default AuthContextProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["React","cookie","jwt_decode","useState","createContext","useEffect","axios","base64","AuthContext","AuthContextProvider","props","loggedIn","setLoggedIn","capabilities","setCapabilities","error","setError","token","setToken","signUp","username","password","object","JSON","stringify","role","console","log","user","fetch","method","headers","body","parsedUser","json","save","e","login","encodedCredentials","encode","config","post","data","validateToken","User","logout","children"],"sources":["/home/adrian/codefellows/401/todo-app/src/context/authContext.jsx"],"sourcesContent":["import React from 'react';\r\nimport cookie from 'react-cookies';\r\nimport jwt_decode from 'jwt-decode';\r\nimport { useState, createContext, useEffect} from 'react';\r\nimport axios from 'axios';\r\nimport base64 from 'base-64';\r\n\r\nexport const AuthContext = createContext();\r\n\r\n// const testUsers = {\r\n//     Administrator: {\r\n//       password: 'admin',\r\n//       name: 'Administrator',\r\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiQWRtaW5pc3RyYXRvciIsInJvbGUiOiJhZG1pbiIsImNhcGFiaWxpdGllcyI6IlsnY3JlYXRlJywncmVhZCcsJ3VwZGF0ZScsJ2RlbGV0ZSddIiwiaWF0IjoxNTE2MjM5MDIyfQ.pAZXAlTmC8fPELk2xHEaP1mUhR8egg9TH5rCyqZhZkQ'\r\n//     },\r\n//     Editor: {\r\n//       password: 'editor',\r\n//       name: 'Editor',\r\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiRWRpdG9yIiwicm9sZSI6ImVkaXRvciIsImNhcGFiaWxpdGllcyI6IlsncmVhZCcsJ3VwZGF0ZSddIiwiaWF0IjoxNTE2MjM5MDIyfQ.3aDn3e2pf_J_1rZig8wj9RiT47Ae2Lw-AM-Nw4Tmy_s'\r\n//     },\r\n//     Writer: {\r\n//       password: 'writer',\r\n//       name: 'Writer',\r\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiV3JpdGVyIiwicm9sZSI6IndyaXRlciIsImNhcGFiaWxpdGllcyI6IlsnY3JlYXRlJ10iLCJpYXQiOjE1MTYyMzkwMjJ9.dmKh8m18mgQCCJp2xoh73HSOWprdwID32hZsXogLZ68'\r\n//     },\r\n//     User: {\r\n//       password: 'user',\r\n//       name: 'User',\r\n//       token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiVXNlciIsInJvbGUiOiJ1c2VyIiwiY2FwYWJpbGl0aWVzIjoiWydyZWFkJ10iLCJpYXQiOjE1MTYyMzkwMjJ9.WXYvIKLdPz_Mm0XDYSOJo298ftuBqqjTzbRvCpxa9Go'\r\n//     },\r\n//   };\r\n\r\n\r\n\r\n  const AuthContextProvider = function (props){\r\n    let [loggedIn, setLoggedIn] = useState(false);\r\n    let [capabilities, setCapabilities] = useState([]);\r\n    let [error, setError] = useState(null);\r\n    let [token, setToken] = useState();\r\n\r\n    let signUp = async (username, password) => {\r\ntry {      let object = JSON.stringify({\r\n        username: username,\r\n        password: password,\r\n        role: 'admin',\r\n      })\r\n      console.log(object)\r\n      let user = await fetch('http://localhost:3001/signup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: object,\r\n      })\r\n      let parsedUser = user.json();\r\n      console.log(parsedUser)\r\n      cookie.save('auth', parsedUser);\r\n      setLoggedIn(true)\r\n      setCapabilities(parsedUser.capabilities)}\r\n      catch(e){\r\n        console.log(e)\r\n      }\r\n    }\r\n\r\n    let login = async (username, password) => {\r\n      try {\r\n        let encodedCredentials = base64.encode(username + ':' + password)\r\n        console.log(encodedCredentials)\r\n        let config = {\r\n          headers:{\r\n            'Authorization': 'Basic ' + encodedCredentials\r\n          }\r\n        }\r\n      let user = await axios.post('http://localhost:3001/signin',{}, config);\r\n      // let parsedUser = user.json();\r\n      console.log(user.data)\r\n      cookie.save('auth', user.data.token);\r\n      setLoggedIn(true)\r\n      setCapabilities(user.data.user.capabilities)\r\n      setToken(user.data.token)\r\n      } catch(e){\r\n        console.log(e);\r\n            }\r\n\r\n\r\n      }\r\n    \r\n      let validateToken = (token) => {\r\n        try{\r\n            let User = jwt_decode(token)\r\n            console.log(User)\r\n            setLoggedIn(true)\r\n            setCapabilities(User.capabilities)\r\n        } catch(e){\r\n            setLoggedIn(false)\r\n            setCapabilities([]);\r\n            console.log('bad token');\r\n        }\r\n      }\r\n\r\n      let logout = () => {\r\n        setLoggedIn(false)\r\n        setCapabilities([]);\r\n      }\r\n\r\n      useEffect(() => {\r\n        // const cookieToken = cookie.load('auth');\r\n        // console.log(cookieToken)\r\n        // validateToken(cookieToken.token);\r\n      }, [])\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ loggedIn, setLoggedIn, capabilities, setCapabilities, error, setError, login, logout, signUp, token }}>\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    )\r\n  }\r\n\r\n  export default AuthContextProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module"}