{"ast":null,"code":"var _jsxFileName = \"/home/adrian/codefellows/401/todo-app/src/context/authContext.jsx\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport cookie from 'react-cookies';\nimport jwt_decode from 'jwt-decode';\nimport { useState, createContext, useEffect } from 'react';\nimport * as dotenv from 'dotenv';\nimport base64 from 'base-64';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nconst AuthContextProvider = function (props) {\n  _s();\n  let [loggedIn, setLoggedIn] = useState(false);\n  let [capabilities, setCapabilities] = useState([]);\n  let [error, setError] = useState(null);\n  let [token, setToken] = useState();\n  let signUp = async (username, password) => {\n    try {\n      let object = JSON.stringify({\n        username: username,\n        password: password,\n        role: 'admin'\n      });\n      console.log(object);\n      let user = await fetch('http://localhost:3001/signup', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: object\n      });\n      let parsedUser = user.json();\n      cookie.save('auth', parsedUser);\n      setLoggedIn(true);\n      setCapabilities(parsedUser.capabilities);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n  let login = async (username, password) => {\n    try {\n      let encodedCredentials = base64.encode(username + ':' + password);\n      console.log(encodedCredentials);\n      let user = await fetch('http://localhost:3001/signin', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Basic ' + encodedCredentials\n        }\n      });\n      let parsedUser = user.json();\n      cookie.save('auth', parsedUser);\n      setLoggedIn(true);\n      setCapabilities(parsedUser.capabilities);\n      setToken(parsedUser.token);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n  let logout = () => {\n    setLoggedIn(false);\n    setCapabilities([]);\n  };\n  useEffect(() => {\n    const cookieToken = cookie.load('auth');\n    validateToken(cookieToken.token);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      loggedIn,\n      setLoggedIn,\n      capabilities,\n      setCapabilities,\n      error,\n      setError,\n      login,\n      logout,\n      signUp,\n      token\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthContextProvider, \"/GARj204bpA/OP9WQX0Y4ZQOj3k=\");\n_c = AuthContextProvider;\nexport default AuthContextProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["React","cookie","jwt_decode","useState","createContext","useEffect","dotenv","base64","AuthContext","AuthContextProvider","props","loggedIn","setLoggedIn","capabilities","setCapabilities","error","setError","token","setToken","signUp","username","password","object","JSON","stringify","role","console","log","user","fetch","method","headers","body","parsedUser","json","save","e","login","encodedCredentials","encode","logout","cookieToken","load","validateToken","children"],"sources":["/home/adrian/codefellows/401/todo-app/src/context/authContext.jsx"],"sourcesContent":["import React from 'react';\r\nimport cookie from 'react-cookies';\r\nimport jwt_decode from 'jwt-decode';\r\nimport { useState, createContext, useEffect} from 'react';\r\nimport * as dotenv from 'dotenv'\r\nimport base64 from 'base-64';\r\n\r\nexport const AuthContext = createContext();\r\n\r\n  const AuthContextProvider = function (props){\r\n    let [loggedIn, setLoggedIn] = useState(false);\r\n    let [capabilities, setCapabilities] = useState([]);\r\n    let [error, setError] = useState(null);\r\n    let [token, setToken] = useState();\r\n\r\n    let signUp = async (username, password) => {\r\ntry {      let object = JSON.stringify({\r\n        username: username,\r\n        password: password,\r\n        role: 'admin',\r\n      })\r\n      console.log(object)\r\n      let user = await fetch('http://localhost:3001/signup', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: object,\r\n      })\r\n      let parsedUser = user.json();\r\n      cookie.save('auth', parsedUser);\r\n      setLoggedIn(true)\r\n      setCapabilities(parsedUser.capabilities)}\r\n      catch(e){\r\n        console.log(e)\r\n      }\r\n    }\r\n\r\n    let login = async (username, password) => {\r\n      try {\r\n        let encodedCredentials = base64.encode(username + ':' + password)\r\n        console.log(encodedCredentials)\r\n        let user = await fetch('http://localhost:3001/signin', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': 'Basic ' + encodedCredentials\r\n        },\r\n      })\r\n      let parsedUser = user.json();\r\n      cookie.save('auth', parsedUser);\r\n      setLoggedIn(true)\r\n      setCapabilities(parsedUser.capabilities);\r\n      setToken(parsedUser.token)\r\n      } catch(e){\r\n        console.log(e);\r\n            }\r\n      }\r\n\r\n      let logout = () => {\r\n        setLoggedIn(false)\r\n        setCapabilities([]);\r\n      }\r\n\r\n      useEffect(() => {\r\n        const cookieToken = cookie.load('auth');\r\n        validateToken(cookieToken.token);\r\n      }, [])\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ loggedIn, setLoggedIn, capabilities, setCapabilities, error, setError, login, logout, signUp, token }}>\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    )\r\n  }\r\n\r\n  export default AuthContextProvider;"],"mappings":"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"},"metadata":{},"sourceType":"module"}